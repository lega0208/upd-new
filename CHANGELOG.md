# Changelog

## [4.1.0](https://github.com/lega0208/upd-new/compare/v4.0.0...v4.1.0) (2025-12-17)


### Features

* "most relevant"-&gt;regular comments for pages/tasks/projects ([2dcdb6f](https://github.com/lega0208/upd-new/commit/2dcdb6fe47884ed3c59323acfa5a6ed5a53d085c))
* Add `sync-parquet` & `recalculate-views` to mongo-parquet + typing improvements ([fec2984](https://github.com/lega0208/upd-new/commit/fec298432e251aad563b889d20f1c66f742fc936))
* Add bun script for python date range tests ([6d04b8d](https://github.com/lega0208/upd-new/commit/6d04b8d83e485f02f386b5bc6090c27dbea85114))
* Add DocumentDB config to DB module ([20429c8](https://github.com/lega0208/upd-new/commit/20429c87ee6b0227be94f55ccc40c9f48fca1178))
* Add DocumentDB config to DB module ([00aa516](https://github.com/lega0208/upd-new/commit/00aa516fc0381df83998d6e958b98b36acbc5230))
* Add modified nx-cloud-main action ([e4d2a09](https://github.com/lega0208/upd-new/commit/e4d2a092ebe17dc1cb61e0fc4635ca5034630c0a))
* Add partial s3 compat to duckdb lib ([987e668](https://github.com/lega0208/upd-new/commit/987e6680489bb25344c3f51925bc1209e00df46f))
* add time limit to url updates; lots of cleanup ([0774675](https://github.com/lega0208/upd-new/commit/07746750d07a680899dc92daf109cd9e444b15e8))
* Add update-db-task app, to use for scheduled ECS task. ([0e287d3](https://github.com/lega0208/upd-new/commit/0e287d35aad3cbf1988d647b477073c01d78d4cf))
* aws-sso ([c31568a](https://github.com/lega0208/upd-new/commit/c31568a54c4e7e02a3365c4210a5242a34cb3746))
* aws-sso ([dcf7f6d](https://github.com/lega0208/upd-new/commit/dcf7f6dcc60a199876b916a7af49381dc186ffd1))
* compress API responses ([6285490](https://github.com/lega0208/upd-new/commit/6285490837c6a6f257b45c91b1091eb21420733b))
* display error on overview instead of infinite spinning wheel ([9bf9740](https://github.com/lega0208/upd-new/commit/9bf97401ad95b133f8d73ff85d54e0c1aa3e4f36))
* ensure index creation on application startup ([9e5fd5f](https://github.com/lega0208/upd-new/commit/9e5fd5f9c8e3fffdc5dfb79363bc8f1290f1129c))
* Modify CI workflows to handle running out of NX free trial credits ([#79](https://github.com/lega0208/upd-new/issues/79)) ([26545e1](https://github.com/lega0208/upd-new/commit/26545e1da500cfb1f92d87dbfa2a6923f3a9ed7f))
* mongo-parquet improvements/overhaul ([22562e9](https://github.com/lega0208/upd-new/commit/22562e97f86d6874e7ba75eb9d1182f344231b2d))
* Overview most relevant comments -&gt; list of comments ([a889708](https://github.com/lega0208/upd-new/commit/a889708e247846b09fee04543c648d3afeabfddd))
* Unified storage client for Azure Blob Storage and S3 ([eeb0801](https://github.com/lega0208/upd-new/commit/eeb0801348e92fde428d2f11ee20cd61ae7b154c))
* update aws-sso script to set credentials in config file ([dbb669f](https://github.com/lega0208/upd-new/commit/dbb669fe7d7e4c06302567efcff0e4d293712caf))
* Update documents/attachments to have flexible storage locations ([f92bbdb](https://github.com/lega0208/upd-new/commit/f92bbdbe2ffc9e90fefab88f2585691ba9a855c8))
* Update documents/attachments to have flexible storage locations ([076f705](https://github.com/lega0208/upd-new/commit/076f7056dc8a731513ec939b0c8fac5934cbbab1))


### Bug Fixes

* @swc/jest config for blob-storage lib ([c7bc9d9](https://github.com/lega0208/upd-new/commit/c7bc9d95ea43d01985bc772ec600f854e4ee6d43))
* `null` page ids throwing error in airtable service ([9854c2d](https://github.com/lega0208/upd-new/commit/9854c2d222b0395231b1f2be8648dca3bccc84f6))
* allow start date to equal end date in mongo-parquet date range iterators ([1d5036d](https://github.com/lega0208/upd-new/commit/1d5036df55aa586fd48f1ae7f396f2f1b958cd30))
* allow start date to equal end date in mongo-parquet date range iterators ([1518f0f](https://github.com/lega0208/upd-new/commit/1518f0ff97030e2959137cc5ab8d2c5ae545b2c0))
* auto-refresh aws credentials in duckdb client ([6b1010e](https://github.com/lega0208/upd-new/commit/6b1010e472640bdc17f9d023e5b9496b2ffae644))
* Cannot read property of `undefined` in activity map service ([3234ff2](https://github.com/lega0208/upd-new/commit/3234ff2d838ed5419fb2fd913be3676758705efc))
* Correct logic for 'Last 52 weeks' date range + add tests ([6b9eaf5](https://github.com/lega0208/upd-new/commit/6b9eaf5ae6998d9658d34b4c02f7a67edaebfec0))
* Custom Filter to utilize getEventValue() method ([67694c5](https://github.com/lega0208/upd-new/commit/67694c578b6bb4d985f6b1faafa43b20c0b2232b))
* don't add protocol to "external" links if they're relative paths ([05d0a08](https://github.com/lega0208/upd-new/commit/05d0a089a9cadefab1dcff575d9388d00ca60059))
* don't throw error if aws cli path doesn't exist ([d1a36da](https://github.com/lega0208/upd-new/commit/d1a36dae040450a0acb9c204272eede61210bde7))
* Ensure proper private key format for GCS client & small type fix for AA client ([6773a61](https://github.com/lega0208/upd-new/commit/6773a613cb96d7c92cdf34321a7a9de2b0fd0018))
* ensure stealth `undefined` arrays don't throw errors in comparison functions ([480412c](https://github.com/lega0208/upd-new/commit/480412cbab171f3bd2e07c47fd6fafc0a644c10b))
* Fix issues with remote storage client ([8216561](https://github.com/lega0208/upd-new/commit/821656186b37cd2a2b78baa588068988bf93765e))
* GCTSS institution filter ([ba87669](https://github.com/lega0208/upd-new/commit/ba876699a59e808ec530aaa09dc8395cce783bfa))
* GCTSS institution filter ([120e8c9](https://github.com/lega0208/upd-new/commit/120e8c97060188adacf0c23401c5c4aa3a01b48c))
* Get DOCUMENTS_URL env variable at runtime ([e7e17c8](https://github.com/lega0208/upd-new/commit/e7e17c86a950965b66e240ea1a670e81fd9d12a6))
* get PageSpeed API key at runtime ([9c36c8e](https://github.com/lega0208/upd-new/commit/9c36c8eae18bcc557f0b7adb265261acc6de72d8))
* get PageSpeed API key at runtime ([7c79aec](https://github.com/lega0208/upd-new/commit/7c79aec7f6920c3217b89d4446c47524cefdf1ae))
* include response size threshold for compression ([bccdaf4](https://github.com/lega0208/upd-new/commit/bccdaf45c24b7d01df08c21da27f62d5d237586a))
* Increase Node max-old-space-size for db-updater ([ccc6cae](https://github.com/lega0208/upd-new/commit/ccc6cae1d06500201dc5a02fac64cb05ee69b156))
* Indexes and hash added/fixed to work with documentdb ([8b55360](https://github.com/lega0208/upd-new/commit/8b5536047566e659b4ef1c9112a4cf1e2e770c81))
* Indexes and hash added/fixed to work with documentdb ([f8c00c0](https://github.com/lega0208/upd-new/commit/f8c00c027e0f47eaf3cca5581455d59fc2635d45))
* initialize PageSpeed client after ConfigModule ([1442b7c](https://github.com/lega0208/upd-new/commit/1442b7c84c24d1e4b07b598c74370c7094e8a3c4))
* initialize PageSpeed client after ConfigModule ([fec796f](https://github.com/lega0208/upd-new/commit/fec796f37cd1d7b2af87c42ef41eb9a8f61d0eff))
* Issues in remote storage clients/duckdb-lib ([fdb4346](https://github.com/lega0208/upd-new/commit/fdb4346f2b66c8c412e964360ca23a00dbe0c00c))
* load frontend data only for current section ([79be056](https://github.com/lega0208/upd-new/commit/79be0560d90f6f91cb65894b7f18eb029bf7ee47))
* Make type checking more strict in db-update and fix type issues/improve types ([90235e8](https://github.com/lega0208/upd-new/commit/90235e8eb6708774dcc774610da6fddbae3832e8))
* Migration-related compatibility fixes ([5b1803c](https://github.com/lega0208/upd-new/commit/5b1803cae65a30b693608d1c172287eee0f8733d))
* Migration-related compatibility fixes ([c8901f8](https://github.com/lega0208/upd-new/commit/c8901f831c186f4e7861a3fe26c69c42c8d19466))
* minor improvement to overview searchterms query ([31242ff](https://github.com/lega0208/upd-new/commit/31242ff1d38cf7cad93179151a81ba37441211e5))
* minor style discrepancies ([91fd5d7](https://github.com/lega0208/upd-new/commit/91fd5d7f917b0053e487a515fda5c5455e2fc0e7))
* minor style discrepancies ([d9dafaa](https://github.com/lega0208/upd-new/commit/d9dafaaadbeaceaae3997e70c2b9c185444559e9))
* mongo-parquet download issues & add min_date option ([d464e11](https://github.com/lega0208/upd-new/commit/d464e119b43a8ecb904297f1322c3deaea7073f9))
* mongo-parquet download issues & add min_date option ([cf88eb1](https://github.com/lega0208/upd-new/commit/cf88eb12985707caf0ec671b9d814df5669f67c0))
* mongo-parquet sync paths ([9759037](https://github.com/lega0208/upd-new/commit/97590375039e7f5e9de5d78a498c3f80e644cb27))
* **mongo-parquet:** include secondary files in `download_from_remote` ([13b5a52](https://github.com/lega0208/upd-new/commit/13b5a52a81b04bb34cb390fb91cddb03347f175e))
* **mongo-parquet:** unintended sampling in incremental sync ([3aa2b14](https://github.com/lega0208/upd-new/commit/3aa2b14249d195b3d09839102a8f982e20e6708b))
* more sync issues ([96c3aa0](https://github.com/lega0208/upd-new/commit/96c3aa023e7839048e2dbedd497fa3649251c91c))
* parquet sync error for partitioned collections ([98963e1](https://github.com/lega0208/upd-new/commit/98963e12e189032c7ab445dac11bb78122da44cc))
* path issues in mongo-parquet sync ([bad394a](https://github.com/lega0208/upd-new/commit/bad394a8ceb10f45a1fe45e26e27479606e381ea))
* Prevent auto-recalculation of views without explicit env var ([306fef5](https://github.com/lega0208/upd-new/commit/306fef557f6bebda068be06ea0663ffea3dc1bfc))
* prevent duckdb azure extension throwing an error ([4b02161](https://github.com/lega0208/upd-new/commit/4b0216140c237f3f6cbe2c94244c9a51d2df73c9))
* prevent duckdb azure extension throwing an error ([159111d](https://github.com/lega0208/upd-new/commit/159111d478ca56d5d3793e5260d77a5c43bbd4bc))
* Prevent error from empty AA search terms ([7c632f0](https://github.com/lega0208/upd-new/commit/7c632f0a905eb90bc0817c1403c622990f008cc8))
* Prevent radial bar component from throwing an error ([e2e0d23](https://github.com/lega0208/upd-new/commit/e2e0d2377c83fb1ca25933d0b40c577ee98a76eb))
* properly format duckdb table remote path ([ee8a206](https://github.com/lega0208/upd-new/commit/ee8a2067d5444732027ac7eeb50e4ff1363e1585))
* properly login with admin role if credentials exist but are expired ([0f95007](https://github.com/lega0208/upd-new/commit/0f95007c0ec7cc01ebd0fc07c37e380bac35b26e))
* properly set up NestJS DI to deduplicate DbService instances ([57d6c42](https://github.com/lega0208/upd-new/commit/57d6c4202e7d377ca37f5227fc5f3ffc544c0e48))
* release-please ([c5ce94f](https://github.com/lega0208/upd-new/commit/c5ce94ffedc65c85cf00fc698f96f5b0a32d2c9a))
* release-please ([60ecd5d](https://github.com/lega0208/upd-new/commit/60ecd5d49f6e081be5d62b09e1b95174b22f6c70))
* require environment variable to enable compressing backend responses ([b3ed468](https://github.com/lega0208/upd-new/commit/b3ed468610ee16c45abcbe8b282965916a986d4c))
* Reverted and fixed activity map for no errors if no value ([b574d96](https://github.com/lega0208/upd-new/commit/b574d9688fd0489a33b7eacea8025339a57fb30d))
* set html_snapshots configuration to `overwrite: true` ([1561b59](https://github.com/lega0208/upd-new/commit/1561b590f8def66a3de081520e11be047aa550a4))
* set proper schema type for AA itemIds ([26ac947](https://github.com/lega0208/upd-new/commit/26ac947e0957641359b3f6f526aebf319d07ffa1))
* set proper schema type for AA itemIds ([21d083f](https://github.com/lega0208/upd-new/commit/21d083f1a3bd39bb661e281830c34eaebfae24a7))
* skip time series collection in ensureIndexes method ([3564d8f](https://github.com/lega0208/upd-new/commit/3564d8f8fd2787e23dcdadf66c6fbf62cb9535ff))
* type error ([fe0dbd1](https://github.com/lega0208/upd-new/commit/fe0dbd11a39c858d8d03ec0c2ad43868229ab18f))
* Unsupported projection operator `$cond` in DocumentDB ([de0fe37](https://github.com/lega0208/upd-new/commit/de0fe372513a2347cf2cf5d26c58dfee8e0f1312))
* update Dockerfile and context path for data import task ([9661df2](https://github.com/lega0208/upd-new/commit/9661df2c89507079f72331822ab2954afa978c95))
* Update remote storage update logic & remove sorting to prevent OOM errors ([5b99200](https://github.com/lega0208/upd-new/commit/5b99200ee3952b377aae7d906d1b6a28fdff28ab))
* use absolute paths for tracking file changes in mongo-parquet sync ([fcada37](https://github.com/lega0208/upd-new/commit/fcada37d65a0d8a83a6a06fff2c35bd87ae8c871))
* Use aggregation in mongo-parquet to properly read from DocumentDB; Fix insert bug; Skip empty collections ([e01da1a](https://github.com/lega0208/upd-new/commit/e01da1ac02aa374d961a39271a499b3b034623c3))
* use correct field names for `callsPer100Visits` andâ€¦ ([99ea78d](https://github.com/lega0208/upd-new/commit/99ea78de01e5ac49f6205570460ca0bf9ac0e88a))
* use correct field names for `callsPer100Visits`/`dyfNoPer1000Visits` in projects.service.ts ([b23b464](https://github.com/lega0208/upd-new/commit/b23b46470cd01132078a1dc3a75bb7c292045cf0))
* use latest date from individual parquet files in mongo-parquet sync ([76ea807](https://github.com/lega0208/upd-new/commit/76ea80732d64275b9199b87e668dd2399fce92eb))
* use the `node` release type for release-please ([d7664cc](https://github.com/lega0208/upd-new/commit/d7664cce8d820b04bb6cc19bf2ec49e18be3abd5))
* wrong regex for pages home in effects ([02c4778](https://github.com/lega0208/upd-new/commit/02c47788eeed45eb18d34c7b5c34774d7a70aeee))
* wrong regex for pages home in effects ([4ffa920](https://github.com/lega0208/upd-new/commit/4ffa920d681c4854e5febf691144f083eed561bd))
* wrong type ([8862a1a](https://github.com/lega0208/upd-new/commit/8862a1a2e2fe7d45537da69cc180c02f1837c667))
* wrong type ([95728ea](https://github.com/lega0208/upd-new/commit/95728eaea5fbd52780e8d78d1f1746e1e81dd9f0))


### Performance Improvements

* Refactor mongo-parquet import to reduce memory usage by &gt;50% ([b2f6351](https://github.com/lega0208/upd-new/commit/b2f63512af94a75faad7dc4ee5f119d38ee414ed))


### Miscellaneous Chores

* Add basedpyright settings to vscode settings.json ([5a214d0](https://github.com/lega0208/upd-new/commit/5a214d02dd60663267e5408c71e05c8fcee9bb6c))
* bootstrap releases for path: . ([e9e5119](https://github.com/lega0208/upd-new/commit/e9e5119a1e9992d2adda938723130e34de4cf9ea))
* bootstrap releases for path: . ([4e2bc85](https://github.com/lega0208/upd-new/commit/4e2bc85efde3459f1ae82b828625da77503b7137))
* re-add release-please manifest ([f013968](https://github.com/lega0208/upd-new/commit/f013968ae34462e0a0be27032d5a49978e9129fb))
* re-add release-please manifest ([5261f37](https://github.com/lega0208/upd-new/commit/5261f37b557f12a970305b0a5df4e4ccead6ac33))
* re-update Node.js version to 24.11.0 in docker publish workflow ([2d254f8](https://github.com/lega0208/upd-new/commit/2d254f810442b9c10a3fdf5ae123bb3feb2a08a2))
* release 4.0.0 ([6db1ddc](https://github.com/lega0208/upd-new/commit/6db1ddc7562f63dcde452d84764b081d86e85364))
* remove view recalculation in db-update-task ([6adcd68](https://github.com/lega0208/upd-new/commit/6adcd6824ad815982d1ef6dccb0d4f86fcc6602a))
* rename docker publish workflow to match CDS repo ([3cebdee](https://github.com/lega0208/upd-new/commit/3cebdee5b0affd34f3f37c222118276218315f9c))
* update @types/node to version 24.9.2 ([66bfdfe](https://github.com/lega0208/upd-new/commit/66bfdfee2dee3e215d9cc9cdea30bc8375e7266c))
* Update dependencies ([605f612](https://github.com/lega0208/upd-new/commit/605f612c391eed952b0c9c2faca0df3871b0ed2d))
* Update devcontainer postCreate command & move to separate script ([e02b2c7](https://github.com/lega0208/upd-new/commit/e02b2c79a46032e1250adbab2eab39a997c35687))
* update docker-publish workflow to match CDS repo ([0329823](https://github.com/lega0208/upd-new/commit/0329823f88b595c2ee8a1dc000d558e6d1883ce6))
* Update mongo-parquet dependencies ([6efe991](https://github.com/lega0208/upd-new/commit/6efe99112bb083a1485c4ac3d9ea8caf7e7a74ff))
* update Node.js version to 24.11.0 in Docker publish workflow ([b4017fe](https://github.com/lega0208/upd-new/commit/b4017fe81fb67cc8b6a0910f4f88665ee23f97b9))
* update package.json scripts and dependencies ([12482a7](https://github.com/lega0208/upd-new/commit/12482a7eba8f2cbfe62f6b65b19b4b3ad89e013c))
* Update package.json scripts, update bun.lock, update .gitignore ([da7eac5](https://github.com/lega0208/upd-new/commit/da7eac54c931a4efe92882241a8ee080dac0704e))
* Update task translations ([19fdb79](https://github.com/lega0208/upd-new/commit/19fdb79773de185890eee7c93e4b4a77ad84e63e))
* Update task translations ([d9ff6ec](https://github.com/lega0208/upd-new/commit/d9ff6ecca4e58037cf0711a7b48c85b3a9e4e6c8))
* Upgrade Node.js version to 24.11.0 in Dockerfiles and CI workflows ([02c263b](https://github.com/lega0208/upd-new/commit/02c263b26243f6a1892e484d7d0c68a8683e9322))


### Code Refactoring

* DocumentDB compatibility updates ([b5b0f84](https://github.com/lega0208/upd-new/commit/b5b0f845966a883855c7d1e893f2a7c8883f873d))
* Fixes and compatibility changes related to AWS migration ([c71ad13](https://github.com/lega0208/upd-new/commit/c71ad134ac0f283ec5fc1c81227747949a14ba91))
* Update storage clients to use a common interface instead of a wrapper class ([284df73](https://github.com/lega0208/upd-new/commit/284df732ad23ff1e9e3859ff8de31140248f03b4))
* Use view for page details ([ff6c1cc](https://github.com/lega0208/upd-new/commit/ff6c1cc8d190a1e6c7cf7dbe6791532d482e1d5e))
